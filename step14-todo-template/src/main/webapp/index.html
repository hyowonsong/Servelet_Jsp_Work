<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>

    <link rel="stylesheet" type="text/css" href="./css/App.css" />
    <link rel="stylesheet" type="text/css" href="./css/Header.css" />
    <link rel="stylesheet" type="text/css" href="./css/List.css" />
    <link rel="stylesheet" type="text/css" href="./css/TodoItem.css" />
    <link rel="stylesheet" type="text/css" href="./css/Editor.css" />
  </head>
  <body>
    <div class="App">
      <div class="Header">
        <h3>ì˜¤ëŠ˜ì˜ PlanğŸ˜Š</h3>
        <h1>2025-10-20</h1>
      </div>
      <form>
        <div class="Editor">
          <input type="text" placeholder="ìƒˆë¡œìš´ todo" id="input" />
          <button>ì¶”ê°€</button>
        </div>
      </form>

      <div class="List">
        <h4>Todo List ğŸŒ±</h4>
        <!--widow + .-->
        <input type="text" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”." id="keyword" />

        <div class="todos_wrapper">
          <!--ì—¬ê¸°ì— í™”ë©´ ì¶œë ¥-->
        </div>
      </div>
    </div>

    <script>
      let day = ["ì¼", "ì›”", "í™”", "ìˆ˜", "ëª©", "ê¸ˆ", "í† "];
      onload = () => {
        initData();

        const today = new Date();
        document.querySelector(
          ".Header > h1"
        ).innerHTML = `${today.getFullYear()}ë…„ ${
          today.getMonth() + 1
        }ì›” ${today.getDate()}ì¼  ${day[today.getDay()]}ìš”ì¼`;
      };

      new URLSearchParams({
        // í¼ë°ì´í„°ë¥¼ ì„œë²„ì— ì „ì†¡í• ë•Œ URLSearchParamsëŠ” key=todoList&methodName=selectAll í˜•íƒœë¡œ ë§Œë“¤ì–´ì¤Œ(ì„œë²„ê°€ ì „í†µì ì¸ ë°©ì‹ìœ¼ë¡œ íŒŒë¼ë¯¸í„° ë°›ì„ ë•Œ ì‚¬ìš©)
        key: "todoList",
        methodName: "selectAll",
      });

      async function initData(word) {
        body = new URLSearchParams({
          // í¼ë°ì´í„°ë¥¼ ì„œë²„ì— ì „ì†¡í• ë•Œ URLSearchParamsëŠ” key=todoList&methodName=selectAll í˜•íƒœë¡œ ë§Œë“¤ì–´ì¤Œ(ì„œë²„ê°€ ì „í†µì ì¸ ë°©ì‹ìœ¼ë¡œ íŒŒë¼ë¯¸í„° ë°›ì„ ë•Œ ì‚¬ìš©)
          // ë‚´ë¶€ì—ì„œ URLSearchParams({...})ë¥¼ ì‚¬ìš©í•˜ì—¬ ì„œë²„ì— ë³´ë‚¼ ì¿¼ë¦¬ íŒŒë¼ë¯¸í„° í˜•ì‹ì˜ ë¬¸ìì—´ì„ ë§Œë“¤ì–´ bodyë¼ëŠ” ë³€ìˆ˜ì— ë‹´ìŠµë‹ˆë‹¤.
          key: "todoList",
          methodName: word ? "selectIncludesbyWord" : "selectAll",
          word: word,
        });

        try {
          // await ì´ ë¶™ì€ ë¶€ë¶„ì€ ì°¨ë¡€ëŒ€ë¡œ í•´ë‹¹ ì‘ì—…ì´ ëë‚  ë•Œê¹Œì§€ ê¸°ë‹¤ë ¸ë‹¤ê°€ ì‘ì—…
          const response = await fetch("ajax", {
            method: "POST",
            body: body,
          });

          // 200ë²ˆëŒ€ê°€ ì•„ë‹ˆë©´ ì˜¤ë¥˜ ëœ¬ë‹¤.
          if (!response.ok) {
            throw new Error("ì„œë²„ ì‘ë‹µ ì—ëŸ¬: " + response.status);
          }

          // ì‘ë‹µ ë³¸ë¬¸ì¸ reponseë¥¼ json()í˜•ì‹ìœ¼ë¡œ íŒŒì‹± í›„ resultì— ë‹´ëŠ”ë‹¤.
          const result = await response.json();

          let todosWrapper = document.querySelector(".todos_wrapper");

          let str = "";
          // ì„œë²„ì—ì„œ ë°›ì€ resut ë°°ì—´ì˜ ê° í•­ëª©(`todo`)ì— ëŒ€í•´ í•˜ë‚˜ì”© ë°˜ë³µí•©ë‹ˆë‹¤.
          // forEachëŠ” í¬ê²Œ currentValue,index,arrayë¡œ ì´ë£¨ì–´ì ¸ ìˆìœ¼ë©°
          // ë³´í†µ currentValue(í˜„ì¬ì˜ todo)ë‘, index(í˜„ì¬ì˜ index)ë¥¼ ëŒë¦¬ëŠ” ê²ƒì„ ë§ì´ ì‚¬ìš©
          result.forEach((todo, index) => {
            str += '<div class="TodoItem">';
            // ì²´í¬ë°•ìŠ¤ ìƒì„±
            // - onChange: ì²´í¬ ìƒíƒœ ë³€ê²½ ì‹œ onUpdate í•¨ìˆ˜ í˜¸ì¶œ
            // - this: í˜„ì¬ ì²´í¬ë°•ìŠ¤ DOM ìš”ì†Œ ì „ë‹¬
            // - todo.id: í•´ë‹¹ todo í•­ëª©ì˜ ê³ ìœ  ID
            // - todo.done: trueë©´ ì²´í¬ë°•ìŠ¤ê°€ ì²´í¬ëœ ìƒíƒœë¡œ ë Œë”ë§ë¨
            str += `<input type="checkbox"  onChange="onUpdate(this , ${
              todo.id
            } )" ${todo.done ? "checked" : ""}/>`;
            str += '<div class="content">' + todo.content + "</div>";
            str += `<div class="date">${todo.date}</div>`;
            // ì‚­ì œ ë²„íŠ¼
            // - name: ì‚­ì œí•  todoì˜ ID ì „ë‹¬
            // - onclick: todoDel í•¨ìˆ˜ í˜¸ì¶œ
            str += `<button name="${todo.id}" onclick="todoDel(this)">ì‚­ì œ</button>`;
            str += "</div>";
          });

          // todosWrapperdp strì„ ë‹´ìŠµë‹ˆë‹¤.
          todosWrapper.innerHTML = str;
        } catch (err) {
          alert("ì—ëŸ¬ ë°œìƒí–ˆì–´ìš”: " + err);
        }
      }

      // ì¶”ê°€ í´ë¦­
      document.querySelector(".Editor > button").onclick = async () => {
        event.preventDefault(); // í¼ ì œì¶œ ì‹œ í˜ì´ì§€ ë¦¬ë¡œë“œë¥¼ ë°©ì§€í•©ë‹ˆë‹¤.

        let inputEle = document.querySelector("#input"); // ì…ë ¥ í•„ë“œë¥¼ ì„ íƒí•©ë‹ˆë‹¤.

        try {
          // ì„œë²„ì— ë°ì´í„°ë¥¼ POSTë¡œ ì „ì†¡í•©ë‹ˆë‹¤. URLSearchParamsë¡œ í¼ ë°ì´í„°ë¥¼ ë§Œë“­ë‹ˆë‹¤.
          const response = await fetch("ajax", {
            method: "POST",
            body: new URLSearchParams({
              // í¼ë°ì´í„°ë¥¼ ì„œë²„ì— ì „ì†¡í• ë•Œ URLSearchParamsëŠ” key=todoList&methodName=selectAll í˜•íƒœë¡œ ë§Œë“¤ì–´ì¤Œ(ì„œë²„ê°€ ì „í†µì ì¸ ë°©ì‹ìœ¼ë¡œ íŒŒë¼ë¯¸í„° ë°›ì„ ë•Œ ì‚¬ìš©)
              key: "todoList", // ì„œë²„ì—ì„œ ì¸ì‹í•  í‚¤, "todoList"
              methodName: "insert", // ì„œë²„ì— ì–´ë–¤ ì‘ì—…ì„ ìš”ì²­í•  ê²ƒì¸ì§€ ("insert" -> ì¶”ê°€)
              content: inputEle.value, // ì…ë ¥ëœ ê°’ì„ contentë¡œ ì „ì†¡
            }),
          });

          if (!response.ok) {
            throw new Error("ì„œë²„ ì‘ë‹µ ì—ëŸ¬: " + response.status);
          }

          const result = await response.json(); // ì„œë²„ ì‘ë‹µì„ JSON í˜•íƒœë¡œ íŒŒì‹±í•©ë‹ˆë‹¤.
          console.log(result); // ê²°ê³¼ë¥¼ ì½˜ì†”ì— ì¶œë ¥í•©ë‹ˆë‹¤.
        } catch (err) {
          alert("ë“±ë¡ì— ë¬¸ì œê°€ ìƒê²»ì–´ìš”.: " + err);
        }

        // ì…ë ¥ í•„ë“œë¥¼ ë¹„ì›ë‹ˆë‹¤.
        document.querySelector("#input").value = "";
        // í•  ì¼ ë°ì´í„°ë¥¼ ë‹¤ì‹œ ê°€ì ¸ì™€ì„œ í™”ë©´ì— ê°±ì‹ í•©ë‹ˆë‹¤.
        initData();

        // return false;
      };

      /////////////////////////////////////////
      //ìˆ˜ì •
      const onUpdate = async (th, id) => {
        //TodoItemì—ì„œ í˜¸ì¶œí• ë•Œ ì „ë‹¬í•œ id
        // <input type="checkbox">ì˜ ì†ì„±(ê¸°ë³¸ ë‚´ì¥ ì†ì„±)
        console.log(th.checked); // ì²´í¬ë°•ìŠ¤ì˜ ìƒíƒœë¥¼ ì½˜ì†”ì— ì¶œë ¥í•©ë‹ˆë‹¤.
        let done = th.checked ? "1" : "0"; // ì²´í¬ë°•ìŠ¤ê°€ ì²´í¬ëœ ìƒíƒœë©´ "1", ì•„ë‹ˆë©´ "0"ìœ¼ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.

        try {
          const response = await fetch("ajax", {
            method: "POST",
            body: new URLSearchParams({
              // í¼ë°ì´í„°ë¥¼ ì„œë²„ì— ì „ì†¡í• ë•Œ URLSearchParamsëŠ” key=todoList&methodName=selectAll í˜•íƒœë¡œ ë§Œë“¤ì–´ì¤Œ(ì„œë²„ê°€ ì „í†µì ì¸ ë°©ì‹ìœ¼ë¡œ íŒŒë¼ë¯¸í„° ë°›ì„ ë•Œ ì‚¬ìš©)
              key: "todoList",
              methodName: "update",
              done,
              id,
            }),
          });

          if (!response.ok) {
            throw new Error("ì„œë²„ ì‘ë‹µ ì—ëŸ¬: " + response.status);
          }

          const result = await response.json();
          console.log(result);
        } catch (err) {
          alert("ìˆ˜ì •ì— ë¬¸ì œê°€ ìƒê²»ì–´ìš”.: " + err);
        }

        // ìˆ˜ì • í›„ í•  ì¼ ë°ì´í„°ë¥¼ ë‹¤ì‹œ ê°€ì ¸ì™€ì„œ í™”ë©´ì— ê°±ì‹ í•©ë‹ˆë‹¤.
        initData();
      };

      ////////////////////////////////////////////////////
      // ì‚­ì œ
      const todoDel = async (th) => {
        let targetId = th.getAttribute("name"); // ì‚­ì œí•  í•­ëª©ì˜ idë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.

        try {
          const response = await fetch("ajax", {
            method: "POST",
            body: new URLSearchParams({
              // í¼ë°ì´í„°ë¥¼ ì„œë²„ì— ì „ì†¡í• ë•Œ URLSearchParamsëŠ” key=todoList&methodName=selectAll í˜•íƒœë¡œ ë§Œë“¤ì–´ì¤Œ(ì„œë²„ê°€ ì „í†µì ì¸ ë°©ì‹ìœ¼ë¡œ íŒŒë¼ë¯¸í„° ë°›ì„ ë•Œ ì‚¬ìš©)
              key: "todoList",
              methodName: "delete",
              targetId,
            }),
          });

          if (!response.ok) {
            throw new Error("ì„œë²„ ì‘ë‹µ ì—ëŸ¬: " + response.status);
          }

          const result = await response.json();
          console.log(result);
        } catch (err) {
          alert("ì‚­ì œì— ë¬¸ì œê°€ ìƒê²»ì–´ìš”.: " + err);
        }

        initData();
      };
      ////////////////////////////////////////////

      //ê²€ìƒ‰
      document.querySelector("#keyword").onkeyup = async (e) => {
        let word = e.target.value;
        /*  try{
        	  const response = await fetch("ajax", {
                  method: "POST",
                  body : new URLSearchParams({ // í¼ë°ì´í„°ë¥¼ ì„œë²„ì— ì „ì†¡í• ë•Œ URLSearchParamsëŠ” key=todoList&methodName=selectAll í˜•íƒœë¡œ ë§Œë“¤ì–´ì¤Œ(ì„œë²„ê°€ ì „í†µì ì¸ ë°©ì‹ìœ¼ë¡œ íŒŒë¼ë¯¸í„° ë°›ì„ ë•Œ ì‚¬ìš©)
                      key: "todoList",
                      methodName: "selectIncludesbyWord",
                      word
                  })
              });

        	  if (!response.ok) {
                  throw new Error("ì„œë²„ ì‘ë‹µ ì—ëŸ¬: " + response.status);
              }
        	  
        	  const result = await response.json();
        	  console.log(result);
        	  
          }catch (err) {
  	        alert("ê²€ìƒ‰ì–´ ì— ë¬¸ì œê°€ ìƒê²»ì–´ìš”.: " + err);
  	      } */

        initData(word);
      };
    </script>
  </body>
</html>
